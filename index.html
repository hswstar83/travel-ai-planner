<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœˆï¸ AI ì—¬í–‰ ê³„íš ì¹˜íŠ¸í‚¤</title>
    <style>
        :root { --primary: #007AFF; --bg: #F2F2F7; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); padding: 20px; display: flex; justify-content: center; margin: 0; }
        .container { max-width: 600px; width: 100%; background: #fff; border-radius: 20px; padding: 25px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        h1 { text-align: center; font-size: 22px; margin-bottom: 5px; color: #333; }
        .subtitle { text-align: center; color: #888; font-size: 13px; margin-bottom: 25px; line-height: 1.4; }
        
        label { display: block; font-weight: 600; margin-bottom: 5px; font-size: 14px; color: #333; }
        input, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 12px; margin-bottom: 15px; box-sizing: border-box; font-family: inherit; font-size: 16px; -webkit-appearance: none; }
        input:focus, textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(0,122,255,0.1); }
        
        button { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 14px; font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.2s; -webkit-appearance: none; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        button:active { transform: scale(0.98); }
        
        /* ê²°ê³¼ í™”ë©´ ìŠ¤íƒ€ì¼ */
        #resultArea { display: none; margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px; }
        #output { white-space: pre-wrap; line-height: 1.6; font-size: 15px; color: #333; background: #f9f9f9; padding: 15px; border-radius: 10px; border: 1px solid #eee; }
        
        /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
        .loader { display: none; text-align: center; margin-top: 20px; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* í”Œëœ B (ì ‘ì† í­ì£¼ ì‹œ) ìŠ¤íƒ€ì¼ */
        #fallbackArea { display: none; margin-top: 20px; padding: 20px; background: #fff8e1; border-radius: 12px; border: 1px solid #ffe082; }
        #fallbackArea h3 { margin-top: 0; color: #f57f17; font-size: 16px; }
        #fallbackArea p { font-size: 13px; color: #f57f17; margin-bottom: 10px; }
        #manualPrompt { background: #fff; border: 1px solid #ffe082; color: #555; font-size: 12px; height: 120px; margin-bottom: 10px; }
        .copy-btn { background-color: #fbc02d; color: #333; margin-top: 0; }
        .copy-btn:hover { background-color: #f9a825; }

        .footer { text-align: center; margin-top: 30px; font-size: 11px; color: #aaa; }
    </style>
</head>
<body>

<div class="container">
    <h1>âœˆï¸ ì›í´ë¦­ ì—¬í–‰ ë¹„ì„œ</h1>
    <p class="subtitle">ì…ë ¥ë§Œ í•˜ë©´ ë‚ ì”¨, ë™ì„ , ë³‘ì› ì •ë³´ê¹Œì§€<br>AIê°€ ì™„ë²½í•œ ê³„íší‘œë¥¼ ì§œë“œë¦½ë‹ˆë‹¤.</p>

    <label>ì—¬í–‰ì§€</label>
    <input type="text" id="destination" placeholder="ì˜ˆ: ë² íŠ¸ë‚¨ ë‹¤ë‚­, ë‚˜ë§Œ ë¦¬íŠ¸ë¦¬íŠ¸">

    <label>ë‚ ì§œ & ê¸°ê°„</label>
    <input type="text" id="dates" placeholder="ì˜ˆ: 12ì›” 19ì¼ ~ 23ì¼ (4ë°• 5ì¼)">

    <label>ì¸ì› êµ¬ì„±</label>
    <input type="text" id="members" placeholder="ì˜ˆ: ë¶€ëª¨ë‹˜(70ëŒ€), ë¶€ë¶€, ì•„ì´(7ì„¸)">

    <label>íŠ¹ë³„ ìš”ì²­ / ê¶ê¸ˆí•œ ì </label>
    <textarea id="special" rows="2" placeholder="ì˜ˆ: ìˆ˜ì˜ì¥ ì˜¨ìˆ˜ ì—¬ë¶€ í™•ì¸, í‚¤ì¦ˆ ë§ˆì‚¬ì§€ ì¶”ì²œ, ê³ ìˆ˜ ë¹¼ì£¼ì„¸ìš”"></textarea>

    <button id="generateBtn" onclick="generatePlan()">âœ¨ ì—¬í–‰ ê³„íš ìƒì„±í•˜ê¸°</button>
    
    <div class="loader" id="loader">
        <div class="spinner"></div>
        <p style="font-size: 13px; color: #666;">AIê°€ ìµœì ì˜ ê²½ë¡œë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...<br>(ì•½ 10~20ì´ˆ ì†Œìš”)</p>
    </div>

    <div id="resultArea">
        <h3 style="margin-bottom: 10px;">ğŸ“ AI ì—¬í–‰ ê³„íší‘œ</h3>
        <div id="output"></div>
    </div>

    <div id="fallbackArea">
        <h3>âš ï¸ ì ‘ì†ìê°€ ë§ì•„ 'ì£¼ë¬¸ì„œ ëª¨ë“œ'ë¡œ ì „í™˜ë¨</h3>
        <p>í˜„ì¬ ì´ìš©ìê°€ ë„ˆë¬´ ë§ì•„ AI ì—°ê²°ì´ ì§€ì—°ë˜ê³  ìˆìŠµë‹ˆë‹¤.<br>ëŒ€ì‹  <b>ì•„ë˜ ì™„ì„±ëœ ì£¼ë¬¸ì„œ</b>ë¥¼ ë³µì‚¬í•´ì„œ <b>Gemini(ì œë¯¸ë‚˜ì´)</b>ë‚˜ <b>ChatGPT</b>ì— ë¶™ì—¬ë„£ìœ¼ë©´ ë˜‘ê°™ì€ ê²°ê³¼ë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p>
        <textarea id="manualPrompt" readonly></textarea>
        <button class="copy-btn" onclick="copyPrompt()">ğŸ“‹ ì£¼ë¬¸ì„œ ë³µì‚¬í•˜ê¸°</button>
    </div>

    <div class="footer">
        Â© 2025 Smart Travel Helper | Powered by Gemini
    </div>
</div>

<script>
    async function generatePlan() {
        const dest = document.getElementById('destination').value;
        const dates = document.getElementById('dates').value;
        const members = document.getElementById('members').value;
        const special = document.getElementById('special').value;

        if(!dest || !dates) { alert("ì—¬í–‰ì§€ì™€ ë‚ ì§œëŠ” ê¼­ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }

        // ë²„íŠ¼ ì ê¸ˆ ë° ë¡œë”© ì‹œì‘
        document.getElementById('generateBtn').disabled = true;
        document.getElementById('generateBtn').innerText = "ë¶„ì„ ì¤‘...";
        document.getElementById('loader').style.display = 'block';
        document.getElementById('resultArea').style.display = 'none';
        document.getElementById('fallbackArea').style.display = 'none';

        // V2.0 ìƒì„¸ í”„ë¡¬í”„íŠ¸ (ì„±ê³µ/ì‹¤íŒ¨ ì‹œ ëª¨ë‘ ì‚¬ìš©)
        const prompt = `
# ì—­í•  ë¶€ì—¬
ë‹¹ì‹ ì€ 20ë…„ ê²½ë ¥ì˜ í˜„ì§€ ì „ë¬¸ ì—¬í–‰ ê°€ì´ë“œì…ë‹ˆë‹¤. ì—¬í–‰ì§€: [${dest}], ì¼ì •: [${dates}], ì¸ì›: [${members}]
ê°€ì¥ ì¤‘ìš”í•œ ì›ì¹™ì€ **êµ¬ì„±ì›ì˜ ì•ˆì „ê³¼ ì»¨ë””ì…˜ ì¡°ì ˆ**ì…ë‹ˆë‹¤.

# í•„ìˆ˜ ìš”ì²­ ì‚¬í•­ (ìƒì„¸íˆ ì‘ì„±)
1. [ë‚ ì”¨ & ì¤€ë¹„ë¬¼] ìœ„ì„± ë‚ ì”¨ ì˜ˆë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì˜·ì°¨ë¦¼ ë° í•„ìˆ˜ ì¤€ë¹„ë¬¼(ìš°ì‚°, ë¹„ìƒì•½ ë“±) ì²´í¬ë¦¬ìŠ¤íŠ¸
2. [ì•ˆì „ ì •ë³´] ìµœê·¼ í˜„ì§€ ì´ìŠˆ(ì¹˜ì•ˆ, ë‚ ì”¨) íŒ©íŠ¸ ì²´í¬ ë° ìˆ™ì†Œ ê·¼ì²˜ 'ì¢…í•©ë³‘ì›'ê³¼ '24ì‹œ ì•½êµ­' êµ¬ê¸€ë§µ ìœ„ì¹˜ ì •ë³´
3. [êµí†µ & íŒ] ê³µí•­-ìˆ™ì†Œ, ê´€ê´‘ì§€ ì´ë™ ì‹œ Grab ì˜ˆìƒ ë¹„ìš© ë° ìƒí™©ë³„ ì ì • íŒ ê¸ˆì•¡(ë§ˆì‚¬ì§€, í˜¸í…” ë“±) ê°€ì´ë“œ
4. [4ë°• 5ì¼ ìƒì„¸ ì¼ì •] 'ì˜¤ì „ íœ´ì‹/ìˆ˜ì˜ - ì˜¤í›„ ê´€ê´‘' íŒ¨í„´ìœ¼ë¡œ êµ¬ì„±ì› ì²´ë ¥ì„ ê³ ë ¤í•œ ìµœì  ë™ì„ . ë§›ì§‘ì€ êµ¬ê¸€ í‰ì  4.5 ì´ìƒë§Œ ì¶”ì²œ(êµ¬ê¸€ë§µ ë§í¬ í•„ìˆ˜).
5. [í˜¸í…” ë¬¸ì˜ ì´ë©”ì¼] ìš”ì²­ì‚¬í•­(${special})ì„ í¬í•¨í•œ ì •ì¤‘í•œ ì˜ì–´ ì´ë©”ì¼ ì´ˆì•ˆ.

# ì¶”ê°€ ìš”ì²­: ${special}

ìœ„ ë‚´ìš©ì„ ê°€ë…ì„± ì¢‹ì€ í‘œì™€ ë¶ˆë › í¬ì¸íŠ¸ë¡œ ì •ë¦¬í•´ ì£¼ì„¸ìš”.
`;

        try {
            // 1. API í˜¸ì¶œ ì‹œë„ (timeout 25ì´ˆ ì„¤ì •)
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 25000);

            const response = await fetch('/api/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt: prompt }),
                signal: controller.signal
            });
            clearTimeout(timeoutId);

            const data = await response.json();
            
            // 2. ì—ëŸ¬ ì²´í¬ (API í•œë„ ì´ˆê³¼ ë˜ëŠ” ì„œë²„ ì˜¤ë¥˜)
            if (!response.ok || data.error) throw new Error("API Limit or Error");

            // 3. ì„±ê³µ ì‹œ ê²°ê³¼ ì¶œë ¥
            let cleanResult = data.result
                .replace(/\n/g, '<br>')
                .replace(/\*\*(.*?)\*\*/g, '<b>$1</b>')
                .replace(/###/g, '')
                .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank" style="color:#007AFF;text-decoration:none;">$1 ğŸ”—</a>'); // ë§í¬ ë³€í™˜

            document.getElementById('output').innerHTML = cleanResult;
            document.getElementById('resultArea').style.display = 'block';

        } catch (error) {
            // 4. ì‹¤íŒ¨ ì‹œ 'í”Œëœ B (ë³µì‚¬ ëª¨ë“œ)'ë¡œ ì „í™˜
            console.log("Fallback triggered:", error);
            document.getElementById('manualPrompt').value = prompt.trim();
            document.getElementById('fallbackArea').style.display = 'block';
            
            // í™”ë©´ì„ ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤í•´ì„œ ì•ˆë‚´ë¬¸ ë³´ì—¬ì£¼ê¸°
            setTimeout(() => {
                document.getElementById('fallbackArea').scrollIntoView({behavior: 'smooth'});
            }, 100);
            
            if(error.name === 'AbortError') {
                alert("ë‹µë³€ì´ ë„ˆë¬´ ê¸¸ì–´ì§€ê³  ìˆì–´ìš”! \nì•„ë˜ 'ì£¼ë¬¸ì„œ'ë¥¼ ë³µì‚¬í•´ì„œ ì œë¯¸ë‚˜ì´ì— ì§ì ‘ ë¬¼ì–´ë³´ëŠ” ê²Œ ë” ë¹ ë¦…ë‹ˆë‹¤.");
            }

        } finally {
            // ë§ˆë¬´ë¦¬ (ë²„íŠ¼ ë³µêµ¬)
            document.getElementById('generateBtn').disabled = false;
            document.getElementById('generateBtn').innerText = "âœ¨ ì—¬í–‰ ê³„íš ìƒì„±í•˜ê¸°";
            document.getElementById('loader').style.display = 'none';
        }
    }

    function copyPrompt() {
        const copyText = document.getElementById("manualPrompt");
        copyText.select();
        copyText.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(copyText.value).then(() => {
            alert("ì£¼ë¬¸ì„œ ë³µì‚¬ ì™„ë£Œ! \nGeminië‚˜ ChatGPT ì•±ì„ ì¼œê³  ë¶™ì—¬ë„£ìœ¼ì„¸ìš”. âœˆï¸");
        });
    }
</script>

</body>
</html>
