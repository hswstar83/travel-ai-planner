<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœˆï¸ AI ì—¬í–‰ ê³„íš ìƒì„±ê¸°</title>
    <style>
        :root { --primary: #007AFF; --bg: #F2F2F7; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); padding: 20px; display: flex; justify-content: center; margin: 0; }
        .container { max-width: 600px; width: 100%; background: #fff; border-radius: 20px; padding: 25px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        h1 { text-align: center; font-size: 22px; margin-bottom: 5px; color: #333; }
        .subtitle { text-align: center; color: #888; font-size: 13px; margin-bottom: 25px; line-height: 1.4; }
        
        label { display: block; font-weight: 600; margin-bottom: 5px; font-size: 14px; color: #333; }
        input, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 12px; margin-bottom: 15px; box-sizing: border-box; font-family: inherit; font-size: 16px; -webkit-appearance: none; }
        input:focus, textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(0,122,255,0.1); }
        
        button { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 14px; font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.2s; -webkit-appearance: none; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        button:active { transform: scale(0.98); }
        
        /* ê²°ê³¼ í™”ë©´ ìŠ¤íƒ€ì¼ */
        #resultArea { display: none; margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px; }
        #output { white-space: pre-wrap; line-height: 1.6; font-size: 15px; color: #333; background: #f9f9f9; padding: 15px; border-radius: 10px; border: 1px solid #eee; }
        
        /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
        .loader { display: none; text-align: center; margin-top: 20px; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* í”Œëœ B (ì ‘ì† í­ì£¼ ì‹œ) ìŠ¤íƒ€ì¼ */
        #fallbackArea { display: none; margin-top: 20px; padding: 20px; background: #fff8e1; border-radius: 12px; border: 1px solid #ffe082; }
        #fallbackArea h3 { margin-top: 0; color: #f57f17; font-size: 16px; }
        #fallbackArea p { font-size: 13px; color: #f57f17; margin-bottom: 10px; }
        #manualPrompt { background: #fff; border: 1px solid #ffe082; color: #555; font-size: 12px; height: 120px; margin-bottom: 10px; width: 100%; box-sizing: border-box; }
        .copy-btn { background-color: #fbc02d; color: #333; margin-top: 10px; }

        .footer { text-align: center; margin-top: 30px; font-size: 11px; color: #aaa; }
    </style>
</head>
<body>

<div class="container">
    <h1>âœˆï¸ AI ì—¬í–‰ ê³„íš ìë™ ìƒì„±ê¸°</h1>
    <p class="subtitle">ì—¬í–‰ ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´<br>AIê°€ ìƒì„¸í•œ ê³„íší‘œë¥¼ ì¦‰ì‹œ ë§Œë“¤ì–´ë“œë¦½ë‹ˆë‹¤.</p>

    <label>ì—¬í–‰ì§€</label>
    <input type="text" id="destination" placeholder="ì˜ˆ: ë² íŠ¸ë‚¨ ë‹¤ë‚­, ë‚˜ë§Œ ë¦¬íŠ¸ë¦¬íŠ¸">

    <label>ë‚ ì§œ & ê¸°ê°„</label>
    <input type="text" id="dates" placeholder="ì˜ˆ: 12ì›” 19ì¼ ~ 23ì¼ (4ë°• 5ì¼)">

    <label>ì¸ì› êµ¬ì„±</label>
    <input type="text" id="members" placeholder="ì˜ˆ: ë¶€ëª¨ë‹˜(70ëŒ€), ë¶€ë¶€, ì•„ì´(7ì„¸)">

    <label>íŠ¹ë³„ ìš”ì²­ / ê¶ê¸ˆí•œ ì </label>
    <textarea id="special" rows="2" placeholder="ì˜ˆ: ìˆ˜ì˜ì¥ ì˜¨ìˆ˜ ì—¬ë¶€ í™•ì¸, í‚¤ì¦ˆ ë§ˆì‚¬ì§€ ì¶”ì²œ, ê³ ìˆ˜ ë¹¼ì£¼ì„¸ìš”"></textarea>

    <button id="generateBtn" onclick="generatePlan()">âœ¨ ì—¬í–‰ ê³„íš ìƒì„±í•˜ê¸°</button>
    
    <div class="loader" id="loader">
        <div class="spinner"></div>
        <p style="font-size: 13px; color: #666;">AIê°€ ìµœì ì˜ ê²½ë¡œë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...<br>(ì•½ 10~15ì´ˆ ì†Œìš”)</p>
    </div>

    <div id="resultArea">
        <h3 style="margin-bottom: 10px;">ğŸ“ AIê°€ ì œì•ˆí•˜ëŠ” ì—¬í–‰ ê³„íš</h3>
        <div id="output"></div>
    </div>

    <div id="fallbackArea">
        <h3>âš ï¸ AI ì„œë²„ ì ‘ì†ëŸ‰ í­ì£¼</h3>
        <p>í˜„ì¬ ì´ìš©ìê°€ ë§ì•„ ìë™ ìƒì„±ì´ ì§€ì—°ë˜ê³  ìˆìŠµë‹ˆë‹¤.<br>ëŒ€ì‹  ì•„ë˜ <b>ì£¼ë¬¸ì„œ</b>ë¥¼ ë³µì‚¬í•´ì„œ ì œë¯¸ë‚˜ì´/ì±—GPTì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”!</p>
        <textarea id="manualPrompt" readonly></textarea>
        <button class="copy-btn" onclick="copyPrompt()">ğŸ“‹ ì£¼ë¬¸ì„œ ë³µì‚¬í•˜ê¸°</button>
    </div>

    <div class="footer">
        Â© 2025 Smart Travel Helper | Powered by Gemini
    </div>
</div>

<script>
    async function generatePlan() {
        const dest = document.getElementById('destination').value;
        const dates = document.getElementById('dates').value;
        const members = document.getElementById('members').value;
        const special = document.getElementById('special').value;

        if(!dest || !dates) { alert("ì—¬í–‰ì§€ì™€ ë‚ ì§œëŠ” ê¼­ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }

        // ë¡œë”© ì‹œì‘
        document.getElementById('generateBtn').disabled = true;
        document.getElementById('generateBtn').innerText = "ë¶„ì„ ì¤‘...";
        document.getElementById('loader').style.display = 'block';
        document.getElementById('resultArea').style.display = 'none';
        document.getElementById('fallbackArea').style.display = 'none';

        // AIì—ê²Œ ë³´ë‚¼ í”„ë¡¬í”„íŠ¸ (ìë™ ì „ì†¡ìš©)
        const prompt = `
# ì—­í• : ë‹¹ì‹ ì€ 20ë…„ ê²½ë ¥ì˜ ë² íŠ¸ë‚¨/ë™ë‚¨ì•„ ì „ë¬¸ ì—¬í–‰ ê°€ì´ë“œì…ë‹ˆë‹¤.
# ëª©í‘œ: ì•„ë˜ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì—¬í–‰ìê°€ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” êµ¬ì²´ì ì¸ ì—¬í–‰ ê³„íšì„œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.

- ì—¬í–‰ì§€: ${dest}
- ì¼ì •: ${dates}
- ì¸ì›: ${members}
- ìš”ì²­ì‚¬í•­: ${special}

# ì‘ì„± ê°€ì´ë“œ (í•„ìˆ˜ í¬í•¨)
1. [ë‚ ì”¨ & ì˜·ì°¨ë¦¼]: ìœ„ì„± ë‚ ì”¨ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ êµ¬ì²´ì ì¸ ì˜·ì°¨ë¦¼ê³¼ ìš°ì‚° í•„ìš” ì—¬ë¶€.
2. [ì´ë™ & êµí†µ]: ê³µí•­ í”½ì—…, ê·¸ë© ì˜ˆìƒ ë¹„ìš©(4ì¸ìŠ¹/7ì¸ìŠ¹), ì¶”ì²œ ì´ë™ ìˆ˜ë‹¨.
3. [ì•ˆì „ & ë³‘ì›]: ìµœê·¼ í˜„ì§€ ì´ìŠˆ íŒ©íŠ¸ì²´í¬, ìˆ™ì†Œ ê·¼ì²˜ ë¹„ìƒ ë³‘ì›/ì•½êµ­ ìœ„ì¹˜.
4. [ìƒì„¸ ì¼ì •í‘œ]: 3ëŒ€ ê°€ì¡±ì˜ ì²´ë ¥ì„ ê³ ë ¤í•œ ì—¬ìœ ë¡œìš´ ì¼ì • (ë§›ì§‘ì€ êµ¬ê¸€í‰ì  4.5 ì´ìƒ ì¶”ì²œ ë° êµ¬ê¸€ë§µ ê²€ìƒ‰ íŒ í¬í•¨).
5. [í˜¸í…” ë¬¸ì˜ ë©”ì¼]: ìš”ì²­ì‚¬í•­(${special})ì„ ë°˜ì˜í•œ ì˜ì–´ ë¬¸ì˜ ë©”ì¼ ì´ˆì•ˆ.

ê²°ê³¼ëŠ” ê°€ë…ì„± ì¢‹ê²Œ **ì œëª©**ê³¼ - ëª©ë¡ì„ ì‚¬ìš©í•˜ì—¬ ê¹”ë”í•˜ê²Œ ì •ë¦¬í•´ì£¼ì„¸ìš”.
`;

        try {
            // 1ë‹¨ê³„: API í˜¸ì¶œ (AIì—ê²Œ ìš”ì²­ ë³´ë‚´ê¸°)
            const response = await fetch('/api/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt: prompt })
            });

            const data = await response.json();
            
            // 2ë‹¨ê³„: ê²°ê³¼ í™•ì¸
            if (!response.ok || data.error) {
                throw new Error("API Error");
            }

            // 3ë‹¨ê³„: í™”ë©´ì— ê²°ê³¼ ë³´ì—¬ì£¼ê¸° (ì¤„ë°”ê¿ˆ, ë³¼ë“œì²´ ì²˜ë¦¬)
            let formattedResult = data.result
                .replace(/\n/g, '<br>') // ì¤„ë°”ê¿ˆ
                .replace(/\*\*(.*?)\*\*/g, '<strong style="color:#007AFF;">$1</strong>') // ê°•ì¡°
                .replace(/###/g, '') // ë§ˆí¬ë‹¤ìš´ ê¸°í˜¸ ì œê±°
                .replace(/- /g, 'â€¢ '); // ëª©ë¡ ê¸°í˜¸ ë³€ê²½

            document.getElementById('output').innerHTML = formattedResult;
            document.getElementById('resultArea').style.display = 'block';

        } catch (error) {
            // ì‹¤íŒ¨ ì‹œ ë³µì‚¬ ëª¨ë“œë¡œ ì „í™˜
            console.error("Error:", error);
            document.getElementById('manualPrompt').value = prompt.trim();
            document.getElementById('fallbackArea').style.display = 'block';
            alert("AI ì—°ê²°ì´ ì§€ì—°ë˜ì–´ 'ì£¼ë¬¸ì„œ ë³µì‚¬ ëª¨ë“œ'ë¡œ ì „í™˜í•©ë‹ˆë‹¤.");
        } finally {
            document.getElementById('generateBtn').disabled = false;
            document.getElementById('generateBtn').innerText = "âœ¨ ì—¬í–‰ ê³„íš ìƒì„±í•˜ê¸°";
            document.getElementById('loader').style.display = 'none';
        }
    }

    function copyPrompt() {
        const copyText = document.getElementById("manualPrompt");
        copyText.select();
        copyText.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(copyText.value).then(() => {
            alert("ì£¼ë¬¸ì„œ ë³µì‚¬ ì™„ë£Œ! Gemini ì•±ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.");
        });
    }
</script>

</body>
</html>
