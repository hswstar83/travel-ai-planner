<script>
    async function generatePlan() {
        const dest = document.getElementById('destination').value;
        const dates = document.getElementById('dates').value;
        const members = document.getElementById('members').value;
        const special = document.getElementById('special').value;

        if(!dest || !dates) { alert("여행지와 날짜는 꼭 입력해주세요!"); return; }

        // 로딩 시작
        document.getElementById('generateBtn').disabled = true;
        document.getElementById('generateBtn').innerText = "분석 중...";
        document.getElementById('loader').style.display = 'block';
        document.getElementById('resultArea').style.display = 'none';

        const prompt = `
# 역할: 20년 경력 베트남 전문 여행 가이드
# 여행 정보: ${dest} / ${dates} / ${members}
# 요청사항: ${special}
# 필수 포함: 날씨, 안전정보, 추천일정(구글맵 링크), 호텔메일초안
`;

        try {
            // 1. API 호출
            const response = await fetch('/api/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt: prompt })
            });

            // 2. 404 에러 체크 (파일 위치 틀림)
            if (response.status === 404) {
                throw new Error("❌ '/api/generate.js' 파일을 찾을 수 없습니다.\n깃허브에 'api' 폴더를 만들고 그 안에 파일을 넣었는지 확인해주세요.");
            }

            const data = await response.json();
            
            // 3. 500 에러 체크 (API 키 문제 등)
            if (!response.ok || data.error) {
                throw new Error("❌ 서버 에러: " + (data.error || "원인 불명"));
            }

            // 4. 성공 시 결과 표시
            let formattedResult = data.result
                .replace(/\n/g, '<br>')
                .replace(/\*\*(.*?)\*\*/g, '<strong style="color:#007AFF;">$1</strong>')
                .replace(/###/g, '')
                .replace(/- /g, '• ');

            document.getElementById('output').innerHTML = formattedResult;
            document.getElementById('resultArea').style.display = 'block';

        } catch (error) {
            console.error("Error:", error);
            // 여기가 핵심! 진짜 에러 내용을 팝업으로 띄워줍니다.
            alert(error.message); 
        } finally {
            document.getElementById('generateBtn').disabled = false;
            document.getElementById('generateBtn').innerText = "✨ 여행 계획 생성하기";
            document.getElementById('loader').style.display = 'none';
        }
    }
</script>
