<script>
    async function generatePlan() {
        const dest = document.getElementById('destination').value;
        const dates = document.getElementById('dates').value;
        const members = document.getElementById('members').value;
        const special = document.getElementById('special').value;

        if(!dest || !dates) { alert("ì—¬í–‰ì§€ì™€ ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }

        document.getElementById('generateBtn').disabled = true;
        document.getElementById('loader').style.display = 'block';
        document.getElementById('resultArea').style.display = 'none';
        document.getElementById('fallbackArea').style.display = 'none'; // ë³µì‚¬ ì˜ì—­ ìˆ¨ê¸°ê¸°

        const prompt = `
ë‹¹ì‹ ì€ ë² íŠ¸ë‚¨ ì „ë¬¸ ì—¬í–‰ ê°€ì´ë“œì…ë‹ˆë‹¤. ì•„ë˜ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ í‘œì™€ ë¶ˆë ›í¬ì¸íŠ¸ë¥¼ ì¨ì„œ ê°€ë…ì„± ì¢‹ì€ ì—¬í–‰ ê³„íšì„ ì§œì£¼ì„¸ìš”.

1. ì—¬í–‰ì§€: ${dest}
2. ë‚ ì§œ: ${dates}
3. ì¸ì›: ${members}
4. ìš”ì²­: ${special}

[í•„ìˆ˜ í¬í•¨ ë‚´ìš©]
1. ë‚ ì”¨ ë¶„ì„ ë° ì˜·ì°¨ë¦¼
2. ì•ˆì „ ì´ìŠˆ ë° ë³‘ì› ì •ë³´
3. 3ëŒ€ ê°€ì¡± ë§ì¶¤ 4ë°• 5ì¼ ìƒì„¸ ì¼ì •í‘œ (ë§›ì§‘ êµ¬ê¸€ë§µ ë§í¬ í¬í•¨í•  ê²ƒ)
4. ì˜ˆìƒ ê²½ë¹„ ë° ì¤€ë¹„ë¬¼ ì²´í¬ë¦¬ìŠ¤íŠ¸
5. í˜¸í…” ë¬¸ì˜ ì´ë©”ì¼ ì´ˆì•ˆ (ì˜ì–´)
`;

        try {
            // 1. API í˜¸ì¶œ ì‹œë„
            const response = await fetch('/api/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt: prompt })
            });

            const data = await response.json();
            
            // 2. ì—ëŸ¬ ì²´í¬ (ì‚¬ëŒ ëª°ë ¤ì„œ ì—ëŸ¬ë‚˜ë©´ catchë¡œ ì´ë™)
            if (!response.ok || data.error) throw new Error("Traffic Limit");

            // 3. ì„±ê³µ ì‹œ ê²°ê³¼ ì¶œë ¥
            document.getElementById('output').innerHTML = data.result
                .replace(/\n/g, '<br>')
                .replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
            
            document.getElementById('resultArea').style.display = 'block';

        } catch (error) {
            // 4. ì‹¤íŒ¨ ì‹œ 'ë³µì‚¬ ëª¨ë“œ'ë¡œ ì „í™˜ (í”Œëœ B)
            document.getElementById('fallbackArea').style.display = 'block';
            document.getElementById('manualPrompt').value = prompt;
            alert("í˜„ì¬ ì ‘ì†ìê°€ ë§ì•„ AI ì‘ë‹µì´ ì§€ì—°ë˜ê³  ìˆìŠµë‹ˆë‹¤. ğŸ˜­\nëŒ€ì‹  ìƒì„±ëœ 'ì£¼ë¬¸ì„œ'ë¥¼ ë³µì‚¬í•´ì„œ ë°”ë¡œ ì‚¬ìš©í•˜ì„¸ìš”!");
            document.getElementById('fallbackArea').scrollIntoView({behavior: 'smooth'});
        } finally {
            document.getElementById('generateBtn').disabled = false;
            document.getElementById('loader').style.display = 'none';
        }
    }

    function copyPrompt() {
        const copyText = document.getElementById("manualPrompt");
        copyText.select();
        copyText.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(copyText.value).then(() => {
            alert("ì£¼ë¬¸ì„œ ë³µì‚¬ ì™„ë£Œ! Geminië‚˜ ì±—GPTì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.");
        });
    }
</script>
